(function(d){var w=d.Array.merge(["click","dblclick","mouseover","mouseout","contextmenu"],d.Support.touch?["touchstart","touchmove","touchend"]:["mousedown","mousemove","mouseup"]),z=/^SOLID$/i,C=/^#[0-9A-F]{6}$/i,E=/^(DOT|DASH|SOLID|DASHDOT)$/i,B=function(k){return(k||"")+d.Util.padded((this%16777215).toString(16),6,0,function(d){return d+this})},u=function(k){return function(){return!d.Array.each(k,function(d,c){c in this&&d.call(this)},this)}}({thick:function(){this.thick=d.Match.isInt(this.thick)?
this.thick:1},alpha:function(){this.alpha=d.Match.isInt(this.alpha)?this.alpha:100},slope:function(){this.slope=d.Match.isNumber(this.slope)?this.slope:!1},matte:function(){this.matte=d.Match.isBoolean(this.matte)?this.matte:!1},arrow:function(){this.arrow=d.Match.isBoolean(this.arrow)?this.arrow:!1},style:function(){this.style=E.test(this.style)?this.style.toUpperCase():"SOLID"},color:function(){this.color=C.test(this.color)?this.color.toUpperCase():"#FF0000"},stuff:function(){this.stuff=C.test(this.stuff)?
this.stuff.toUpperCase():!0===this.stuff?this.color:!1},angle:function(){this.angle=d.Match.isNumber((this.angle||0).f)&&d.Match.isNumber((this.angle||0).t)?this.angle:null},extra:function(){this.extra=d.Match.isNumber((this.extra||0).x)&&d.Match.isNumber((this.extra||0).y)?this.extra:null},point:function(){this.point=d.Match.isNumber((this.point||0).x)&&d.Match.isNumber((this.point||0).y)?this.point:null}}),q={rgb2hex:function(d,g,c){return(16777216+(d<<16)+(g<<8)+c).toString(16).slice(1)},pos2len:function(d,
g,c,e){return Math.sqrt((d=c-d)*d+(g=e-g)*g)},pos4arc:function(d,g,c,e,r,t){c*=Math.cos(r);e*=Math.sin(r);r=Math.cos(t);t=Math.sin(t);return[d+(c*r-e*t),g+(c*t+e*r)]},pos4crv:function(k,g,c,e,r,t,q,f,l){var b,h=(b=d.Match.isDefined(l))?l*l:q*q;return b?[q*(b=h*l)+3*r*(h-b)+3*c*(l-2*h+b)+k*(1-3*l+3*h-b),f*b+3*t*(h-b)+3*e*(l-2*h+b)+g*(1-3*l+3*h-b)]:[r*h+c*(2*q-2*h)+k*(1-2*q+h),t*h+e*(2*q-2*h)+g*(1-2*q+h)]},ang2ecc:function(d,g,c){return Math.atan2(g*Math.sin(d*Math.PI/180),c*Math.cos(d*Math.PI/180))},
trans2d:function(){this.prototype={offset:function(k){return k?[d.Math.fix(this.m[4],10),d.Math.fix(this.m[5],10)]:[this.m[4],this.m[5]]},matrix:function(k){return k?[d.Math.fix(this.m[0],10),d.Math.fix(this.m[2],10),d.Math.fix(this.m[1],10),d.Math.fix(this.m[3],10),0,0]:this.m},matmul:function(d,g,c){this.m[5]=this.m[1]*d[4]+(g=this.m[3])*d[5]+this.m[5];this.m[4]=this.m[0]*d[4]+(c=this.m[2])*d[5]+this.m[4];this.m[3]=this.m[1]*d[2]+g*d[3];this.m[2]=this.m[0]*d[2]+c*d[3];this.m[1]=this.m[1]*d[0]+g*
d[1];this.m[0]=this.m[0]*d[0]+c*d[1];return this},rotate:function(k,g,c){var e=Math.cos(k);k=Math.sin(k);d.Match.isNumber(g)&&d.Match.isNumber(c)?(this.matmul.call(this,[e,k,-k,e,g,c]),this.matmul.call(this,[1,0,0,1,-g,-c])):(this.m[0]=(g=this.m[0])*e+this.m[2]*k,this.m[1]=(c=this.m[1])*e+this.m[3]*k,this.m[2]=g*-k+this.m[2]*e,this.m[3]=c*-k+this.m[3]*e);return this}};return this}.call(function(){this.m=[1,0,0,1,0,0]})},D=d.Support.graphic.svg?function(k,g){k.prototype={A:function(c){for(var e=0,
g=c.length;e<g;e+=7)d.Array.push(this.save,"A",c[e],c[e+1],c[e+2],c[e+3],c[e+4],c[e+5],c[e+6]);return this},C:function(c){for(var e=0,g=c.length;e<g;e+=6)d.Array.push(this.save,"C",c[e],c[e+1],c[e+2],c[e+3],c[e+4],c[e+5]);return this},Q:function(c){for(var e=0,g=c.length;e<g;e+=4)d.Array.push(this.save,"Q",c[e],c[e+1],c[e+2],c[e+3]);return this},L:function(c){for(var e=0,g=c.length;e<g;e+=2)d.Array.push(this.save,"L",c[e],c[e+1]);return this},M:function(c){for(var e=0,g=c.length;e<g;e+=2)d.Array.push(this.save,
"M",c[e],c[e+1]);return this},Z:function(){return d.Array.push(this.save,"Z")&&this},P:function(){return d.Array.join(this.save," ")}};return function(c,e,r,t){var v=0,f,l,b={x:0,y:0,w:0,h:0},h=function(b){return function(a){return function(y){b.apply(this,arguments);a.apply(this,arguments);d.Thread.delay.call(c,function(){try{(f.shapes[y.ident=B.call(v++,"_")]=this).paint()}catch(a){y.error=a}finally{y.error||(this.regist("mouseout",function(){d.Util.setMouse(r,r.title="")}),this.regist("mouseover",
d.Util.bind(this,function(){r.title=this.title||"";d.Util.setMouse(r,this.mouse)})))}},0,this)}}}(function(b,a){this.title=a.title;this.alpha=a.alpha;this.matte=a.matte;this.mouse=a.mouse;this.front=function(){(b||0).alive&&(!b.svg2d||b.run2d?d.Thread.delay.call(c,arguments.callee):f.appendChild(b.svg2d))};this.erase=function(){if(!b.svg2d||b.run2d)d.Thread.delay.call(c,arguments.callee,0,this);else if((b||0).alive&&f.removeChild(b.svg2d)){var y=delete f.shapes[b.ident];try{y&&"arrow"in this&&(y=
!!l.removeChild(d.Array.pop(d.Fn.css.call(l,"#"+b.ident))))}catch(m){y=!1}finally{!y&&(f.shapes[b.ident]=this)?f.appendChild(b.svg2d):(a=d.Array.each(b,function(a,d){delete b[d]}),b=d.Array.each(this,function(a,d){delete this[d]},this))}}};this.regist=function(a,m){d.Match.isFunction(m)&&-1<d.Array.index(w,a=d.Parse.toTxt(a))&&function(){(b||0).alive&&(!b.svg2d||b.run2d?d.Thread.delay.call(c,arguments.callee,0,this):(m[b.ident]||(m[b.ident]={}))[a]=d.Util.addEvent({evt:a,arg:this,obj:b.svg2d,fun:function(a){m.call(this,
a,this)}},!0))}.call(this)};this.reject=function(a,m){d.Match.isFunction(m)&&-1<d.Array.index(w,a=d.Parse.toTxt(a))&&function(){(b||0).alive&&(!b.svg2d||b.run2d?d.Thread.delay.call(c,arguments.callee,0,this):d.Thread.delay.call(c,function(c){((c=m[b.ident])||0)[a]&&d.Util.delEvent(c[a])&&delete c[a]}))}.call(this)}}),p={styleTo:function(b,a){switch(b){case "SOLID":return"";case "DOT":return d.Array.join([a,3*a]," ");case "DASH":return d.Array.join([4*a,3*a]," ");case "DASHDOT":return d.Array.join([4*
a,3*a,a,3*a]," ")}}};this.refix=function(n){if(!(f||0).shapes)d.Thread.delay.call(c,arguments.callee);else if(n=n||d.Util.getElemSize(r))try{d.Util.setElemSize(f,{w:b.w=d.Parse.toInt(n.w)||0,h:b.h=d.Parse.toInt(n.h)||0})}catch(a){n=null}finally{n&&(n=this.slice(b))}};this.slice=function(n){(f||0).setAttribute&&f.setAttribute("viewBox",d.Array.join([0-(b.x=d.Parse.toInt(n.x)||0),0-(b.y=d.Parse.toInt(n.y)||0),b.w,b.h]," "))};this.ready=function(){if(!t)try{t=!d.Fx.draw.call(c,f=r.appendChild(e.createElementNS("http://www.w3.org/2000/svg",
"svg")),["<defs></defs>"],function(){(f.shapes={},this.refix())||d.Fx.draw.call(c,l=f.childNodes[0],['<path id="arrow-classic" d="M5 0 0 2.5 5 5 3.5 3 3.5 2Z" stroke-linecap="round"></path>'],function(){f.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink")})},this)}catch(b){t=!1}return t};this.renew=function(){(f||0).shapes?d.Array.each(f.shapes,function(d){d.paint()}):d.Thread.delay.call(c,arguments.callee)};this.clear=function(){(f||0).shapes?d.Array.each(f.shapes,
function(d){d.erase()}):d.Thread.delay.call(c,arguments.callee)};this.build={LINE:h(function(b,a){this.route=a.route;this.thick=a.thick;this.color=a.color;this.arrow=a.arrow;this.style=a.style;this.paint=function(){if((b||0).alive)if(b.run2d||!f||!l||!b.ident)d.Thread.delay.call(c,arguments.callee,0,this);else if(u.call(this)){var a,m=(a=3<(this.route||0).length)?(new k).M(d.Array.slice(this.route,0,2)).L(d.Array.slice(this.route,2)).P():"M 0 0";b.svg2d&&!(b.svg2d.style.display=this.matte?"none":
"")?(b.svg2d.setAttribute("d",m),b.svg2d.setAttribute("stroke",this.color),b.svg2d.setAttribute("stroke-width",this.thick),b.svg2d.setAttribute("opacity",this.alpha/100),b.svg2d.setAttribute("marker-end",this.arrow&&a?"url(#"+b.ident+")":""),b.svg2d.setAttribute("stroke-dasharray",p.styleTo(this.style,this.thick))):b.run2d=!d.Fx.draw.call(c,f,[d.Util.format(g.line,[m,b.ident,this.color,this.thick,this.alpha/100,p.styleTo(this.style,this.thick),this.matte?"none":""])],function(){(b.svg2d=d.Array.pop(d.Fn.css.call(f,
"."+b.ident)))&&d.Fx.draw.call(c,l,[d.Util.format(g.mark,[b.ident,this.color])],function(){(b.run2d=!1,!this.matte)&&this.arrow&&a&&b.svg2d.setAttribute("marker-end","url(#"+b.ident+")")},this)},this)}}}),RECT:h(function(b,a){this.point=a.point;this.extra=a.extra;this.thick=a.thick;this.color=a.color;this.stuff=a.stuff;this.slope=a.slope;this.style=a.style;this.paint=function(){if((b||0).alive)if(b.run2d||!f||!l||!b.ident)d.Thread.delay.call(c,arguments.callee,0,this);else if(u.call(this)){var a=
this.point&&this.extra?(new k).M([this.point.x-this.extra.x,this.point.y-this.extra.y]).L([this.point.x-this.extra.x,this.point.y+this.extra.y,this.point.x+this.extra.x,this.point.y+this.extra.y,this.point.x+this.extra.x,this.point.y-this.extra.y,this.point.x-this.extra.x,this.point.y-this.extra.y]).P():"M 0 0",m=!this.matte&&this.slope&&"M 0 0"!==a?"matrix("+(new q.trans2d).rotate(-this.slope*Math.PI/180,this.point.x,this.point.y).matrix()+")":!1;b.svg2d&&!(b.svg2d.style.display=this.matte?"none":
"")?(b.svg2d.setAttribute("d",a),b.svg2d.setAttribute("opacity",this.alpha/100),b.svg2d.setAttribute("stroke-width",this.thick),b.svg2d.setAttribute("stroke",this.color),b.svg2d.setAttribute("fill",this.stuff||"none"),b.svg2d.setAttribute("stroke-dasharray",p.styleTo(this.style,this.thick)),m?b.svg2d.setAttribute("transform",m):b.svg2d.removeAttribute("transform")):b.run2d=!d.Fx.draw.call(c,f,[d.Util.format(g.rect,[a,b.ident,this.color,this.thick,this.alpha/100,p.styleTo(this.style,this.thick),this.matte?
"none":"",this.stuff||"none"])],function(){(b.run2d=!1,b.svg2d=d.Array.pop(d.Fn.css.call(f,"."+b.ident)))&&m&&b.svg2d.setAttribute("transform",m)})}}}),POLY:h(function(b,a){this.route=a.route;this.thick=a.thick;this.color=a.color;this.stuff=a.stuff;this.style=a.style;this.paint=function(){if((b||0).alive)if(b.run2d||!f||!l||!b.ident)d.Thread.delay.call(c,arguments.callee,0,this);else if(u.call(this)){var a=3<(this.route||0).length?(new k).M(d.Array.slice(this.route,0,2)).L(d.Array.slice(this.route,
2)).Z().P():"M 0 0";b.svg2d&&!(b.svg2d.style.display=this.matte?"none":"")?(b.svg2d.setAttribute("d",a),b.svg2d.setAttribute("opacity",this.alpha/100),b.svg2d.setAttribute("stroke-width",this.thick),b.svg2d.setAttribute("stroke",this.color),b.svg2d.setAttribute("fill",this.stuff||"none"),b.svg2d.setAttribute("stroke-dasharray",p.styleTo(this.style,this.thick))):b.run2d=!d.Fx.draw.call(c,f,[d.Util.format(g.poly,[a,b.ident,this.color,this.thick,this.alpha/100,p.styleTo(this.style,this.thick),this.matte?
"none":"",this.stuff||"none"])],function(){b.run2d=(b.svg2d=d.Array.pop(d.Fn.css.call(f,"."+b.ident)))&&!1})}}}),OVAL:h(function(b,a){this.point=a.point;this.extra=a.extra;this.thick=a.thick;this.color=a.color;this.stuff=a.stuff;this.slope=a.slope;this.style=a.style;this.paint=function(){if((b||0).alive)if(b.run2d||!f||!l||!b.ident)d.Thread.delay.call(c,arguments.callee,0,this);else if(u.call(this)){var a=this.point&&this.extra?(new k).M([this.point.x,this.point.y-this.extra.y]).A([this.extra.x,this.extra.y,
0,1,1,this.point.x,this.point.y+this.extra.y]).A([this.extra.x,this.extra.y,0,1,1,this.point.x,this.point.y-this.extra.y]).P():"M 0 0",m=!this.matte&&this.slope&&"M 0 0"!==a?"matrix("+(new q.trans2d).rotate(-this.slope*Math.PI/180,this.point.x,this.point.y).matrix()+")":!1;b.svg2d&&!(b.svg2d.style.display=this.matte?"none":"")?(b.svg2d.setAttribute("d",a),b.svg2d.setAttribute("opacity",this.alpha/100),b.svg2d.setAttribute("stroke-width",this.thick),b.svg2d.setAttribute("stroke",this.color),b.svg2d.setAttribute("fill",
this.stuff||"none"),b.svg2d.setAttribute("stroke-dasharray",p.styleTo(this.style,this.thick)),m?b.svg2d.setAttribute("transform",m):b.svg2d.removeAttribute("transform")):b.run2d=!d.Fx.draw.call(c,f,[d.Util.format(g.oval,[a,b.ident,this.color,this.thick,this.alpha/100,p.styleTo(this.style,this.thick),this.matte?"none":"",this.stuff||"none"])],function(){(b.run2d=!1,b.svg2d=d.Array.pop(d.Fn.css.call(f,"."+b.ident)))&&m&&b.svg2d.setAttribute("transform",m)})}}}),ARCH:h(function(b,a){this.angle=a.angle;
this.point=a.point;this.extra=a.extra;this.thick=a.thick;this.color=a.color;this.stuff=a.stuff;this.slope=a.slope;this.style=a.style;this.paint=function(){if((b||0).alive)if(b.run2d||!f||!l||!b.ident)d.Thread.delay.call(c,arguments.callee,0,this);else if(u.call(this)){var a=this.point&&this.extra&&this.angle?(new k).M(q.pos4arc(this.point.x,this.point.y,this.extra.x,this.extra.y,-q.ang2ecc(this.angle.f,this.extra.x,this.extra.y),0)).A(d.Array.merge([this.extra.x,this.extra.y,0,180<this.angle.t-this.angle.f?
1:0,0],q.pos4arc(this.point.x,this.point.y,this.extra.x,this.extra.y,-q.ang2ecc(this.angle.t,this.extra.x,this.extra.y),0))).L([this.point.x,this.point.y]).Z().P():"M 0 0",m=!this.matte&&this.slope&&"M 0 0"!==a?"matrix("+(new q.trans2d).rotate(-this.slope*Math.PI/180,this.point.x,this.point.y).matrix()+")":!1;b.svg2d&&!(b.svg2d.style.display=this.matte?"none":"")?(b.svg2d.setAttribute("d",a),b.svg2d.setAttribute("opacity",this.alpha/100),b.svg2d.setAttribute("stroke-width",this.thick),b.svg2d.setAttribute("stroke",
this.color),b.svg2d.setAttribute("fill",this.stuff||"none"),b.svg2d.setAttribute("stroke-dasharray",p.styleTo(this.style,this.thick)),m?b.svg2d.setAttribute("transform",m):b.svg2d.removeAttribute("transform")):b.run2d=!d.Fx.draw.call(c,f,[d.Util.format(g.arch,[a,b.ident,this.color,this.thick,this.alpha/100,p.styleTo(this.style,this.thick),this.matte?"none":"",this.stuff||"none"])],function(){(b.run2d=!1,b.svg2d=d.Array.pop(d.Fn.css.call(f,"."+b.ident)))&&m&&b.svg2d.setAttribute("transform",m)})}}}),
WAVE:h(function(b,a){this.route=a.route;this.thick=a.thick;this.color=a.color;this.arrow=a.arrow;this.style=a.style;this.paint=function(){if((b||0).alive)if(b.run2d||!f||!l||!b.ident)d.Thread.delay.call(c,arguments.callee,0,this);else if(u.call(this)){var a,m=(a=5<(this.route||0).length)?(new k).M(d.Array.slice(this.route,0,2))[8===this.route.length?"C":"Q"](d.Array.slice(this.route,2)).P():"M 0 0";b.svg2d&&!(b.svg2d.style.display=this.matte?"none":"")?(b.svg2d.setAttribute("d",m),b.svg2d.setAttribute("stroke",
this.color),b.svg2d.setAttribute("stroke-width",this.thick),b.svg2d.setAttribute("opacity",this.alpha/100),b.svg2d.setAttribute("marker-end",this.arrow&&a?"url(#"+b.ident+")":""),b.svg2d.setAttribute("stroke-dasharray",p.styleTo(this.style,this.thick))):b.run2d=!d.Fx.draw.call(c,f,[d.Util.format(g.wave,[m,b.ident,this.color,this.thick,this.alpha/100,p.styleTo(this.style,this.thick),this.matte?"none":""])],function(){(b.svg2d=d.Array.pop(d.Fn.css.call(f,"."+b.ident)))&&d.Fx.draw.call(c,l,[d.Util.format(g.mark,
[b.ident,this.color])],function(){(b.run2d=!1,!this.matte)&&this.arrow&&a&&b.svg2d.setAttribute("marker-end","url(#"+b.ident+")")},this)},this)}}})}}}(function(){this.save=[]},{line:'<path d="$1" class="$2" stroke="$3" stroke-width="$4" opacity="$5" stroke-dasharray="$6" style="display:$7;" fill="none"></path>',rect:'<path d="$1" class="$2" stroke="$3" stroke-width="$4" opacity="$5" stroke-dasharray="$6" style="display:$7;" fill="$8"></path>',poly:'<path d="$1" class="$2" stroke="$3" stroke-width="$4" opacity="$5" stroke-dasharray="$6" style="display:$7;" fill="$8"></path>',
oval:'<path d="$1" class="$2" stroke="$3" stroke-width="$4" opacity="$5" stroke-dasharray="$6" style="display:$7;" fill="$8"></path>',arch:'<path d="$1" class="$2" stroke="$3" stroke-width="$4" opacity="$5" stroke-dasharray="$6" style="display:$7;" fill="$8"></path>',wave:'<path d="$1" class="$2" stroke="$3" stroke-width="$4" opacity="$5" stroke-dasharray="$6" style="display:$7;" fill="none"></path>',mark:'<marker id="$1" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5"><use xlink:href="#arrow-classic" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="$2" stroke="none"></use></marker>'}):
d.Support.graphic.cav?function(k,g,c,e){var r=0,t=[],v={},f={},l=0,b=0,h=g.createElement("canvas");g=function(a){return function(b){return function(m){a.apply(this,arguments);b.apply(this,arguments);var A;if(0<r++%1E3)A=t[t.length-1];else{A=d.Util.getElemSize(c);var e={shapes:{},mirror:h.cloneNode(!1),canvas:c.appendChild(h.cloneNode(!1))};e.canvas.style.position=e.mirror.style.position="absolute";e.canvas.height=e.mirror.height=d.Parse.toInt(A.h);e.canvas.width=e.mirror.width=d.Parse.toInt(A.w);
A=t[d.Array.push(t,e)-1]}if((m.scene=A)&&(m.cav2d=m.scene.canvas.getContext("2d"))&&(m.mir2d=m.scene.mirror.getContext("2d")))try{(m.scene.shapes[m.ident=B.call(r,"#")]=this).paint(!0)}catch(f){m.error=f}}}}(function(a,b){this.title=b.title;this.alpha=b.alpha;this.matte=b.matte;this.mouse=b.mouse;this.front=function(){if((a||0).alive&&delete a.scene.shapes[a.ident])try{this.paint()}catch(b){(a.scene.shapes[a.ident]=this).paint()}finally{!a.scene.shapes[a.ident]&&(a.scene=t[t.length-1])&&(a.cav2d=
a.scene.canvas.getContext("2d"))&&(a.mir2d=a.scene.mirror.getContext("2d"))&&(a.scene.shapes[a.ident]=this).paint()}};this.erase=function(){if((a||0).alive&&delete a.scene.shapes[a.ident])try{this.paint()}catch(m){(a.scene.shapes[a.ident]=this).paint()}finally{a.scene.shapes[a.ident]||(d.Array.each(w,function(b){(v[b]||0)[a.ident]&&delete v[b][a.ident]}),b=d.Array.each(a,function(b,d){delete a[d]}),a=d.Array.each(this,function(a,b){delete this[b]},this))}};this.regist=function(b,c){(a||0).alive&&
d.Match.isFunction(c)&&(b=v[d.Parse.toTxt(b)])&&d.Array.push(b[a.ident]||(b[a.ident]=[]),c)};this.reject=function(b,c){(a||0).alive&&d.Match.isFunction(c)&&(b=(v[d.Parse.toTxt(b)]||0)[a.ident])&&d.Array.remove(b,c)}});var p=function(){for(var a=t.length-1,b=d.Util.getMouse.call(k,this),m=d.Util.getPosition(c),e=Math.round(b.x-m.x),f=Math.round(b.y-m.y);0<=a;a--)if(255===((m=(b=t[a]).mirror.getContext("2d").getImageData(e,f,1,1).data)||0)[3])return{ident:m="#"+q.rgb2hex(m[0],m[1],m[2]),shape:b.shapes[m]}},
n={styleTo:{line:function(a){return function(b,d,c,e,f,h){switch(b){case "SOLID":this.lineTo(e,f);break;case "DOT":a.call(this,d,c,e,f,[h,3*h]);break;case "DASH":a.call(this,d,c,e,f,[4*h,3*h]);break;case "DASHDOT":a.call(this,d,c,e,f,[4*h,3*h,h,3*h])}}}(function(a,b,m,c,e){for(var f=e.length,h=m-a,n=c-b,g=h>n,p,k=0,l=0,r=Math.sqrt(h*h+n*n),q=d.Array.max([d.Array.min([g?n/h:h/n,9999]),-9999]);.1<=(r-=l);)p=Math.sqrt((l=(0===(l=e[k++%f])?.001:l)>r?r:l)*l/(1+q*q)),g?(a+=0>h&&0>n?-1*p:p,b+=0>h&&0>n?q*
p*-1:q*p):(a+=0>h&&0>n?q*p*-1:q*p,b+=0>h&&0>n?-1*p:p),this[k%2?"lineTo":"moveTo"](a,b);this.moveTo(m,c)}),oval:function(a){return function(b,d,c,e,f,h){switch(b){case "SOLID":this.arc(d,c,e,0,2*Math.PI,!1);break;case "DOT":a.call(this,d,c,e,f,[h,3*h]);break;case "DASH":a.call(this,d,c,e,f,[4*h,3*h]);break;case "DASHDOT":a.call(this,d,c,e,f,[4*h,3*h,h,3*h])}}}(function(a,b,d,c,e){var f=1/Math.floor(Math.PI*(1.5*(d+c)-Math.sqrt(d*c))),h=d*d,n=c*c;c=h+n;for(var h=h-n,n=e.length,g=0,p=0,l=0,k=0;l<=Math.PI;l+=
f)(p+=Math.sqrt(c-h*Math.cos(2*l))*f*.707)>=e[g]&&(0===g%2&&(this.moveTo((p=q.pos4arc(a,b,d,d,k,0))[0],p[1]),this.arc(a,b,d,k,l,!1),this.moveTo((p=q.pos4arc(a,b,d,d,k+Math.PI,0))[0],p[1]),this.arc(a,b,d,k+Math.PI,l+Math.PI,!1)),k=l,p=0,g=(g+1)%n)}),arch:function(a){return function(b,d,c,e,f,h,g,p){if(z.test(b))this.arc(d,c,e,h,g,!1),this.lineTo(d,c),this.closePath();else{var l=q.pos4arc(d,c,e,e,h,0),k=q.pos4arc(d,c,e,e,g,0);switch(b){case "DOT":a.call(this,d,c,e,f,h,g,[p,3*p]);this.moveTo(k[0],k[1]);
n.styleTo.line.call(this,b,k[0],k[1],0,0,p);this.moveTo(0,0);n.styleTo.line.call(this,b,0,0,l[0],l[1],p);break;case "DASH":a.call(this,d,c,e,f,h,g,[4*p,3*p]);this.moveTo(k[0],k[1]);n.styleTo.line.call(this,b,k[0],k[1],0,0,p);this.moveTo(0,0);n.styleTo.line.call(this,b,0,0,l[0],l[1],p);break;case "DASHDOT":a.call(this,d,c,e,f,h,g,[4*p,3*p,p,3*p]),this.moveTo(k[0],k[1]),n.styleTo.line.call(this,b,k[0],k[1],0,0,p),this.moveTo(0,0),n.styleTo.line.call(this,b,0,0,l[0],l[1],p)}}}}(function(a,b,d,c,e,f,
h){var p=1/Math.floor(Math.PI*(1.5*(d+c)-Math.sqrt(d*c))),n=d*d,g=c*c;c=n+g;for(var n=n-g,g=h.length,k=0,l=0,r=e;r<=f;r+=p)(l+=Math.sqrt(c-n*Math.cos(2*r))*p*.707)>=h[k]&&(0===k%2&&(this.moveTo((l=q.pos4arc(a,b,d,d,e,0))[0],l[1]),this.arc(a,b,d,e,r,!1)),e=r,l=0,k=(k+1)%g)}),wave:function(a){return function(b,d,c){if(z.test(b))switch(d.length){case 8:this.bezierCurveTo(d[2],d[3],d[4],d[5],d[6],d[7]);break;case 6:this.quadraticCurveTo(d[2],d[3],d[4],d[5])}else switch(b){case "DOT":a.call(this,d,[c,
3*c]);break;case "DASH":a.call(this,d,[4*c,3*c]);break;case "DASHDOT":a.call(this,d,[4*c,3*c,c,3*c])}}}(function(a,b){for(var d,c,e,f,h,n,p,g,k=8===a.length,l=1/(q.pos2len(d=a[0],c=a[1],e=a[2],f=a[3])+q.pos2len(e,f,h=a[4],n=a[5])+(k?q.pos2len(h,n,p=a[6],g=a[7]):0)),r=[d,c],t=b.length,u=0,v=0,w=0,x;1>=w;w+=l)x=k?q.pos4crv(d,c,e,f,h,n,p,g,w):q.pos4crv(d,c,e,f,h,n,w),(v+=q.pos2len(r[0],r[1],x[0],x[1]))>=b[u]&&(u%2===(v=0)&&this.lineTo(x[0],x[1]),u=(u+1)%t,this.moveTo(x[0],x[1])),0===u%2&&this.lineTo(x[0],
x[1]),r=x})},arrowTo:function(a,b,d,c){this.save();this.beginPath();this.translate(a,b);this.moveTo(0,0);this.rotate(d);this.lineTo(-2-c,-1-.5*c);this.lineTo(-1.4-.7*c,0);this.lineTo(-2-c,1+.5*c);this.closePath();this.restore()}};this.refix=function(a){(a=a||d.Util.getElemSize(c))&&d.Array.each(t,function(b){b.canvas.width=b.mirror.width=d.Parse.toInt(a.w)||0;b.canvas.height=b.mirror.height=d.Parse.toInt(a.h)||0})};this.slice=function(a){l=d.Parse.toInt(a.x)||0;b=d.Parse.toInt(a.y)||0;this.renew()};
this.ready=function(){if(!e)try{e=!d.Array.each(w,function(a){return function(b,m){2<m?d.Util.addEvent({obj:c,evt:b,fun:function(m){switch(b){case "touchstart":case "mousedown":return function(b,d){a.call(b,(f.click=!0,m))};case "touchmove":case "mousemove":return function(b,e){if(((e=p.call(b))||0).shape){c.title=e.shape.title||"";d.Util.setMouse(c,e.shape.mouse);try{d.Array.each(m[e.ident],function(a){a.call(this,b,this)},e.shape)}catch(h){}finally{if(f.shape!==e.shape&&f.ident!==e.ident)try{a.call(b)}catch(h){}finally{(f.ident=
e.ident)&&(f.shape=e.shape)&&a.call(b,v.mouseover)}}}else{d.Util.setMouse(c,c.title="");try{a.call(b)}catch(h){}finally{f.ident=f.shape=null,f.click=f.again=!1}}};case "touchend":case "mouseup":return function(b,c){try{a.call(b,m)}catch(e){}finally{if(f.click&&1===d.Util.getKey(b))try{a.call(b,v.click)}catch(e){}finally{try{f.again&&a.call(b,v.dblclick)}catch(e){}finally{!d.Support.touch&&(f.again=!0)&&d.Thread.delay.call(k,function(){f.again=!1},300)}}}f.click=!1};case "mouseout":return function(b){try{a.call(b,
m)}catch(d){}finally{f.ident=f.shape=null,f.click=f.again=!1}};case "contextmenu":return function(b){try{a.call(b,m)}catch(d){}finally{f.click=f.again=!1}}}}(v[b]={})},!0):v[b]={}}}(function(a){f.ident&&f.shape&&d.Array.each((a||v.mouseout)[f.ident],function(a){a.call(f.shape,this,f.shape)},this)}))}catch(a){e=!1}return e};this.renew=function(){var a=[];try{d.Array.each(t,function(b){d.Array.each(b.shapes,function(b){return d.Array.push(a,b)&&!1})})}catch(b){}finally{for(;a.length;)d.Array.pop(a).paint()}};
this.clear=function(){var a=[];try{d.Array.each(t,function(b){d.Array.each(b.shapes,function(c,e){delete b.shapes[e]&&d.Array.push(a,c)})})}catch(b){}finally{for(;a.length;)d.Array.pop(a).erase()}};this.build={LINE:g(function(a,c){this.route=c.route;this.thick=c.thick;this.color=c.color;this.arrow=c.arrow;this.style=c.style;this.paint=function(c){if((a||0).alive&&a.ident&&a.cav2d&&a.mir2d)if(d.Match.isDefined(c)){if(!0===c&&3<(c=(this.route||0).length)&&u.call(this)&&!this.matte){a.cav2d.save();a.mir2d.save();
a.cav2d.beginPath();a.mir2d.beginPath();a.cav2d.translate(l,b);a.mir2d.translate(l,b);a.cav2d.moveTo(this.route[0],this.route[1]);a.mir2d.moveTo(this.route[0],this.route[1]);for(var e=2;e<c;e+=2)n.styleTo.line.call(a.cav2d,this.style,this.route[e-2],this.route[e-1],this.route[e],this.route[e+1],this.thick),n.styleTo.line.call(a.mir2d,this.style,this.route[e-2],this.route[e-1],this.route[e],this.route[e+1],this.thick);a.cav2d.save();a.mir2d.save();a.mir2d.lineWidth=a.cav2d.lineWidth=this.thick;a.cav2d.globalAlpha=
this.alpha/100;a.cav2d.strokeStyle=this.color;a.mir2d.strokeStyle=a.ident;a.cav2d.stroke();a.mir2d.stroke();a.cav2d.restore();a.mir2d.restore();this.arrow&&(c=d.Array.slice(this.route,-4))&&(n.arrowTo.call(a.cav2d,c[2],c[3],Math.atan2(c[3]-c[1],c[2]-c[0]),this.thick),n.arrowTo.call(a.mir2d,c[2],c[3],Math.atan2(c[3]-c[1],c[2]-c[0]),this.thick),a.cav2d.save(),a.mir2d.save(),a.mir2d.lineWidth=a.cav2d.lineWidth=this.thick,a.cav2d.globalAlpha=this.alpha/100,a.cav2d.strokeStyle=this.color,a.cav2d.fillStyle=
this.color,a.mir2d.strokeStyle=a.ident,a.mir2d.fillStyle=a.ident,a.cav2d.stroke(),a.mir2d.stroke(),a.cav2d.fill(),a.mir2d.fill(),a.cav2d.restore(),a.mir2d.restore());a.cav2d.restore();a.mir2d.restore()}}else d.Array.each(a.cav2d.clearRect(0,0,a.scene.canvas.width,a.scene.canvas.height)||a.mir2d.clearRect(0,0,a.scene.mirror.width,a.scene.mirror.height)||a.scene.shapes,function(a){a.paint(!0)})}}),RECT:g(function(a,c){this.point=c.point;this.extra=c.extra;this.thick=c.thick;this.color=c.color;this.stuff=
c.stuff;this.slope=c.slope;this.style=c.style;this.paint=function(c){if((a||0).alive&&a.ident&&a.cav2d&&a.mir2d)if(d.Match.isDefined(c)){if(!0===c&&u.call(this)&&!this.matte&&this.point&&this.extra){c=[-this.slope*Math.PI/180,-this.extra.x,-this.extra.y,-this.extra.x,this.extra.y,this.extra.x,this.extra.y,this.extra.x,-this.extra.y,-this.extra.x,-this.extra.y];try{a.cav2d.save();a.mir2d.save();a.cav2d.beginPath();a.mir2d.beginPath();a.cav2d.translate(this.point.x+l,this.point.y+b);a.mir2d.translate(this.point.x+
l,this.point.y+b);a.cav2d.rotate(c[0]);a.mir2d.rotate(c[0]);a.cav2d.moveTo(c[1],c[2]);a.mir2d.moveTo(c[1],c[2]);for(var e=3;11>e;e+=2)n.styleTo.line.call(a.cav2d,this.style,c[e-2],c[e-1],c[e],c[e+1],this.thick),n.styleTo.line.call(a.mir2d,this.style,c[e-2],c[e-1],c[e],c[e+1],this.thick);a.cav2d.restore();a.mir2d.restore();a.cav2d.save();a.mir2d.save();a.mir2d.lineWidth=a.cav2d.lineWidth=this.thick;a.cav2d.globalAlpha=this.alpha/100;a.cav2d.strokeStyle=this.color;a.mir2d.strokeStyle=a.ident;a.cav2d.stroke();
a.mir2d.stroke();a.cav2d.restore();a.mir2d.restore();if(this.stuff){if(!z.test(this.style)){a.cav2d.save();a.mir2d.save();a.cav2d.beginPath();a.mir2d.beginPath();a.cav2d.translate(this.point.x+l,this.point.y+b);a.mir2d.translate(this.point.x+l,this.point.y+b);a.cav2d.rotate(c[0]);a.mir2d.rotate(c[0]);a.cav2d.moveTo(c[1],c[2]);a.mir2d.moveTo(c[1],c[2]);for(e=3;11>e;e+=2)a.cav2d.lineTo(c[e],c[e+1]),a.mir2d.lineTo(c[e],c[e+1]);a.cav2d.restore();a.mir2d.restore()}a.cav2d.save();a.mir2d.save();a.cav2d.globalAlpha=
this.alpha/100;a.cav2d.fillStyle=this.stuff;a.mir2d.fillStyle=a.ident;a.cav2d.fill();a.mir2d.fill();a.cav2d.restore();a.mir2d.restore()}}catch(h){}finally{d.Array.clear(c)}}}else d.Array.each(a.cav2d.clearRect(0,0,a.scene.canvas.width,a.scene.canvas.height)||a.mir2d.clearRect(0,0,a.scene.mirror.width,a.scene.mirror.height)||a.scene.shapes,function(a){a.paint(!0)})}}),POLY:g(function(a,c){this.route=c.route;this.thick=c.thick;this.color=c.color;this.stuff=c.stuff;this.style=c.style;this.paint=function(c){if((a||
0).alive&&a.ident&&a.cav2d&&a.mir2d)if(d.Match.isDefined(c)){if(!0===c&&3<(c=(this.route||0).length)&&u.call(this)&&!this.matte){a.cav2d.save();a.mir2d.save();a.cav2d.beginPath();a.mir2d.beginPath();a.cav2d.translate(l,b);a.mir2d.translate(l,b);a.cav2d.moveTo(this.route[0],this.route[1]);a.mir2d.moveTo(this.route[0],this.route[1]);for(var e=0;e<c;e+=2)n.styleTo.line.call(a.cav2d,this.style,this.route[e],this.route[e+1],this.route[e+2]||this.route[0],this.route[e+3]||this.route[1],this.thick),n.styleTo.line.call(a.mir2d,
this.style,this.route[e],this.route[e+1],this.route[e+2]||this.route[0],this.route[e+3]||this.route[1],this.thick);a.cav2d.restore();a.mir2d.restore();a.cav2d.save();a.mir2d.save();a.mir2d.lineWidth=a.cav2d.lineWidth=this.thick;a.cav2d.globalAlpha=this.alpha/100;a.cav2d.strokeStyle=this.color;a.mir2d.strokeStyle=a.ident;a.cav2d.stroke();a.mir2d.stroke();a.cav2d.restore();a.mir2d.restore();if(this.stuff){if(!z.test(this.style)){a.cav2d.save();a.mir2d.save();a.cav2d.beginPath();a.mir2d.beginPath();
a.cav2d.translate(l,b);a.mir2d.translate(l,b);a.cav2d.moveTo(this.route[0],this.route[1]);a.mir2d.moveTo(this.route[0],this.route[1]);for(e=2;e<c;e+=2)a.cav2d.lineTo(this.route[e],this.route[e+1]),a.mir2d.lineTo(this.route[e],this.route[e+1]);a.cav2d.closePath();a.mir2d.closePath();a.cav2d.restore();a.mir2d.restore()}a.cav2d.save();a.mir2d.save();a.cav2d.globalAlpha=this.alpha/100;a.cav2d.fillStyle=this.stuff;a.mir2d.fillStyle=a.ident;a.cav2d.fill();a.mir2d.fill();a.cav2d.restore();a.mir2d.restore()}}}else d.Array.each(a.cav2d.clearRect(0,
0,a.scene.canvas.width,a.scene.canvas.height)||a.mir2d.clearRect(0,0,a.scene.mirror.width,a.scene.mirror.height)||a.scene.shapes,function(a){a.paint(!0)})}}),OVAL:g(function(a,c){this.point=c.point;this.extra=c.extra;this.thick=c.thick;this.color=c.color;this.stuff=c.stuff;this.slope=c.slope;this.style=c.style;this.paint=function(c){if((a||0).alive&&a.ident&&a.cav2d&&a.mir2d)if(d.Match.isDefined(c)){if(!0===c&&u.call(this)&&!this.matte&&this.point&&this.extra){c=[this.point.x+l,this.point.y+b,this.extra.x,
this.extra.y,-this.slope*Math.PI/180];try{a.cav2d.save(),a.mir2d.save(),a.cav2d.beginPath(),a.mir2d.beginPath(),a.cav2d.translate(c[0],c[1]),a.mir2d.translate(c[0],c[1]),a.cav2d.rotate(c[4]),a.mir2d.rotate(c[4]),a.cav2d.scale(1,c[3]/c[2]),a.mir2d.scale(1,c[3]/c[2]),n.styleTo.oval.call(a.cav2d,this.style,0,0,c[2],c[3],this.thick),n.styleTo.oval.call(a.mir2d,this.style,0,0,c[2],c[3],this.thick),a.cav2d.restore(),a.mir2d.restore(),a.cav2d.save(),a.mir2d.save(),a.mir2d.lineWidth=a.cav2d.lineWidth=this.thick,
a.cav2d.globalAlpha=this.alpha/100,a.cav2d.strokeStyle=this.color,a.mir2d.strokeStyle=a.ident,a.cav2d.stroke(),a.mir2d.stroke(),a.cav2d.restore(),a.mir2d.restore(),this.stuff&&(z.test(this.style)||(a.cav2d.save(),a.mir2d.save(),a.cav2d.beginPath(),a.mir2d.beginPath(),a.cav2d.translate(c[0],c[1]),a.mir2d.translate(c[0],c[1]),a.cav2d.rotate(c[4]),a.mir2d.rotate(c[4]),a.cav2d.scale(1,c[3]/c[2]),a.mir2d.scale(1,c[3]/c[2]),a.cav2d.arc(0,0,c[2],0,2*Math.PI,!0),a.mir2d.arc(0,0,c[2],0,2*Math.PI,!0),a.cav2d.restore(),
a.mir2d.restore()),a.cav2d.save(),a.mir2d.save(),a.cav2d.globalAlpha=this.alpha/100,a.cav2d.fillStyle=this.stuff,a.mir2d.fillStyle=a.ident,a.cav2d.fill(),a.mir2d.fill(),a.cav2d.restore(),a.mir2d.restore())}catch(e){}finally{d.Array.clear(c)}}}else d.Array.each(a.cav2d.clearRect(0,0,a.scene.canvas.width,a.scene.canvas.height)||a.mir2d.clearRect(0,0,a.scene.mirror.width,a.scene.mirror.height)||a.scene.shapes,function(a){a.paint(!0)})}}),ARCH:g(function(a,c){this.angle=c.angle;this.point=c.point;this.extra=
c.extra;this.thick=c.thick;this.color=c.color;this.stuff=c.stuff;this.slope=c.slope;this.style=c.style;this.paint=function(c){if((a||0).alive&&a.ident&&a.cav2d&&a.mir2d)if(d.Match.isDefined(c)){if(!0===c&&u.call(this)&&!this.matte&&this.point&&this.extra&&this.angle){c=[this.point.x+l,this.point.y+b,this.extra.x,this.extra.y,-this.slope*Math.PI/180,-q.ang2ecc(this.angle.f,this.extra.x,this.extra.y),-q.ang2ecc(this.angle.t,this.extra.x,this.extra.y)];try{a.cav2d.save(),a.mir2d.save(),a.cav2d.beginPath(),
a.mir2d.beginPath(),a.cav2d.translate(c[0],c[1]),a.mir2d.translate(c[0],c[1]),a.cav2d.rotate(c[4]),a.mir2d.rotate(c[4]),a.cav2d.scale(1,c[3]/c[2]),a.mir2d.scale(1,c[3]/c[2]),n.styleTo.arch.call(a.cav2d,this.style,0,0,c[2],c[3],c[6],c[5],this.thick),n.styleTo.arch.call(a.mir2d,this.style,0,0,c[2],c[3],c[6],c[5],this.thick),a.cav2d.restore(),a.mir2d.restore(),a.cav2d.save(),a.mir2d.save(),a.mir2d.lineWidth=a.cav2d.lineWidth=this.thick,a.cav2d.globalAlpha=this.alpha/100,a.cav2d.strokeStyle=this.color,
a.mir2d.strokeStyle=a.ident,a.cav2d.stroke(),a.mir2d.stroke(),a.cav2d.restore(),a.mir2d.restore(),this.stuff&&(z.test(this.style)||(a.cav2d.save(),a.mir2d.save(),a.cav2d.beginPath(),a.mir2d.beginPath(),a.cav2d.translate(c[0],c[1]),a.mir2d.translate(c[0],c[1]),a.cav2d.rotate(c[4]),a.mir2d.rotate(c[4]),a.cav2d.scale(1,c[3]/c[2]),a.mir2d.scale(1,c[3]/c[2]),a.cav2d.arc(0,0,c[2],c[5],c[6],!0),a.mir2d.arc(0,0,c[2],c[5],c[6],!0),a.cav2d.lineTo(0,0),a.mir2d.lineTo(0,0),a.cav2d.closePath(),a.mir2d.closePath(),
a.cav2d.restore(),a.mir2d.restore()),a.cav2d.save(),a.mir2d.save(),a.cav2d.globalAlpha=this.alpha/100,a.cav2d.fillStyle=this.stuff,a.mir2d.fillStyle=a.ident,a.cav2d.fill(),a.mir2d.fill(),a.cav2d.restore(),a.mir2d.restore())}catch(e){}finally{d.Array.clear(c)}}}else d.Array.each(a.cav2d.clearRect(0,0,a.scene.canvas.width,a.scene.canvas.height)||a.mir2d.clearRect(0,0,a.scene.mirror.width,a.scene.mirror.height)||a.scene.shapes,function(a){a.paint(!0)})}}),WAVE:g(function(a,c){this.route=c.route;this.thick=
c.thick;this.color=c.color;this.arrow=c.arrow;this.style=c.style;this.paint=function(c){(a||0).alive&&a.ident&&a.cav2d&&a.mir2d&&(d.Match.isDefined(c)?!0===c&&5<(c=(this.route||0).length)&&u.call(this)&&!this.matte&&(a.cav2d.save(),a.mir2d.save(),a.cav2d.beginPath(),a.mir2d.beginPath(),a.cav2d.translate(l,b),a.mir2d.translate(l,b),a.cav2d.moveTo(this.route[0],this.route[1]),a.mir2d.moveTo(this.route[0],this.route[1]),n.styleTo.wave.call(a.cav2d,this.style,this.route,this.thick),n.styleTo.wave.call(a.mir2d,
this.style,this.route,this.thick),a.cav2d.save(),a.mir2d.save(),a.mir2d.lineWidth=a.cav2d.lineWidth=this.thick,a.cav2d.globalAlpha=this.alpha/100,a.cav2d.strokeStyle=this.color,a.mir2d.strokeStyle=a.ident,a.cav2d.stroke(),a.mir2d.stroke(),a.cav2d.restore(),a.mir2d.restore(),this.arrow&&(c=d.Array.slice(this.route,-4))&&(n.arrowTo.call(a.cav2d,c[2],c[3],Math.atan2(c[3]-c[1],c[2]-c[0]),this.thick),n.arrowTo.call(a.mir2d,c[2],c[3],Math.atan2(c[3]-c[1],c[2]-c[0]),this.thick),a.cav2d.save(),a.mir2d.save(),
a.mir2d.lineWidth=a.cav2d.lineWidth=this.thick,a.cav2d.globalAlpha=this.alpha/100,a.cav2d.strokeStyle=this.color,a.cav2d.fillStyle=this.color,a.mir2d.strokeStyle=a.ident,a.mir2d.fillStyle=a.ident,a.cav2d.stroke(),a.mir2d.stroke(),a.cav2d.fill(),a.mir2d.fill(),a.cav2d.restore(),a.mir2d.restore()),a.cav2d.restore(),a.mir2d.restore()):d.Array.each(a.cav2d.clearRect(0,0,a.scene.canvas.width,a.scene.canvas.height)||a.mir2d.clearRect(0,0,a.scene.mirror.width,a.scene.mirror.height)||a.scene.shapes,function(a){a.paint(!0)}))}})}}:
d.Support.graphic.vml?function(k,g){k.prototype={A:function(c){for(var e=0,g=c.length;e<g;e+=6)d.Array.push(this.save,"AE",Math.round(c[e]),Math.round(c[e+1]),Math.round(c[e+2]),Math.round(c[e+3]),Math.round(c[e+4]),Math.round(c[e+5]));return this},C:function(c){for(var e=0,g=c.length;e<g;e+=6)d.Array.push(this.save,"C",Math.round(c[e]),Math.round(c[e+1]),Math.round(c[e+2]),Math.round(c[e+3]),Math.round(c[e+4]),Math.round(c[e+5]));return this},Q:function(c){for(var e=2,g=c.length;e<g;e+=4)d.Array.push(this.save,
"C",Math.round(c[e-2]/3+2*c[e]/3),Math.round(c[e-1]/3+2*c[e+1]/3),Math.round(c[e+2]/3+2*c[e]/3),Math.round(c[e+3]/3+2*c[e+1]/3),Math.round(c[e+2]),Math.round(c[e+3]));return this},L:function(c){for(var e=0,g=c.length;e<g;e+=2)d.Array.push(this.save,"L",Math.round(c[e]),Math.round(c[e+1]));return this},M:function(c){for(var e=0,g=c.length;e<g;e+=2)d.Array.push(this.save,"M",Math.round(c[e]),Math.round(c[e+1]));return this},Z:function(c){return d.Array.push(this.save,"XE")&&this},P:function(){return d.Array.join(this.save,
" ")}};return function(c,e,r,t){var v=0,f,l=function(b){return function(e){return function(g){b.apply(this,arguments);e.apply(this,arguments);d.Thread.delay.call(c,function(){try{(f.shapes[g.ident=B.call(v++,"_")]=this).paint()}catch(b){g.error=b}finally{g.error||(this.regist("mouseout",function(){d.Util.setMouse(r,r.title="")}),this.regist("mouseover",d.Util.bind(this,function(){r.title=this.title||"";d.Util.setMouse(r,this.mouse)})))}},0,this)}}}(function(b,e){this.title=e.title;this.alpha=e.alpha;
this.matte=e.matte;this.mouse=e.mouse;this.front=function(){(b||0).alive&&(!b.vml2d||b.run2d?d.Thread.delay.call(c,arguments.callee):f.appendChild(b.vml2d))};this.erase=function(){!b.vml2d||b.run2d?d.Thread.delay.call(c,arguments.callee,0,this):(b||0).alive&&f.removeChild(b.vml2d)&&(delete f.shapes[b.ident]?(e=d.Array.each(b,function(c,d){delete b[d]}),b=d.Array.each(this,function(b,c){delete this[c]},this)):f.appendChild(b.vml2d))};this.regist=function(e,f){d.Match.isFunction(f)&&-1<d.Array.index(w,
e=d.Parse.toTxt(e))&&function(){(b||0).alive&&(!b.vml2d||b.run2d?d.Thread.delay.call(c,arguments.callee,0,this):(f[b.ident]||(f[b.ident]={}))[e]=d.Util.addEvent({evt:e,arg:this,obj:b.vml2d,fun:function(a){f.call(this,a,this)}},!0))}.call(this)};this.reject=function(e,f){d.Match.isFunction(f)&&-1<d.Array.index(w,e=d.Parse.toTxt(e))&&function(){(b||0).alive&&(!b.vml2d||b.run2d?d.Thread.delay.call(c,arguments.callee,0,this):d.Thread.delay.call(c,function(a){((a=f[b.ident])||0)[e]&&d.Util.delEvent(a[e])&&
delete a[e]}))}.call(this)}});this.refix=function(b){(f||0).shapes&&(b=b||d.Util.getElemSize(r))&&(d.Parse.toInt(b.w),d.Parse.toInt(b.h))};this.slice=function(b){(f||0).style&&d.Util.setElemSeat(f,{t:d.Parse.toInt(b.y)||0,l:d.Parse.toInt(b.x)||0})};this.ready=function(){if(!t&&e.namespaces.add("v","urn:schemas-microsoft-com:vml")){var b=e.createStyleSheet();try{t=((f=r.appendChild(document.createElement('<v:group style="position:absolute;top:0;left:0;width:1px;height:1px;" coordsize="1,1" coordorigin="0 0"><v:/group>'))).shapes=
{},!d.Array.each("v\\:fill v\\:skew v\\:shape v\\:image v\\:group v\\:stroke v\\:textbox".split(" "),function(c){b.addRule(c,"position:absolute;behavior:url(#default#VML);display:inline-block;")}))}catch(c){t=!1}finally{b=null}}return t};this.renew=function(){(f||0).shapes&&d.Array.each(f.shapes,function(b){b.paint()})};this.clear=function(){(f||0).shapes&&d.Array.each(f.shapes,function(b){b.erase()})};this.build={LINE:l(function(b,e){this.route=e.route;this.thick=e.thick;this.color=e.color;this.arrow=
e.arrow;this.style=e.style;this.paint=function(){if((b||0).alive)if(b.run2d||!f||!b.ident)d.Thread.delay.call(c,arguments.callee,0,this);else if(u.call(this)){var e=3<(this.route||0).length?(new k).M(d.Array.slice(this.route,0,2)).L(d.Array.slice(this.route,2)).P():"M 0 0";b.vml2d&&!(b.vml2d.style.display=this.matte?"none":"")?(b.vml2d.path=e,b.vml2d.write.color=this.color,b.vml2d.write.weight=this.thick,b.vml2d.write.dashstyle=this.style,b.vml2d.write.opacity=this.alpha/100,b.vml2d.write.endarrow=
this.arrow?"classic":"none"):b.run2d=!d.Fx.draw.call(c,f,[d.Util.format(g.line,[e,b.ident,this.color,this.thick,this.alpha/100,this.style,this.arrow?"classic":"none",this.matte?"none":""])],function(){if(b.run2d=!1,b.vml2d=d.Array.pop(d.Fn.css.call(f,"."+b.ident)))b.vml2d.write=d.Dom.getFore(b.vml2d)})}}}),RECT:l(function(b,e){this.point=e.point;this.extra=e.extra;this.thick=e.thick;this.color=e.color;this.stuff=e.stuff;this.slope=e.slope;this.style=e.style;this.paint=function(){if((b||0).alive)if(b.run2d||
!f||!b.ident)d.Thread.delay.call(c,arguments.callee,0,this);else if(u.call(this)){var e=this.point&&this.extra?(new k).M([this.point.x-this.extra.x,this.point.y-this.extra.y]).L([this.point.x-this.extra.x,this.point.y+this.extra.y,this.point.x+this.extra.x,this.point.y+this.extra.y,this.point.x+this.extra.x,this.point.y-this.extra.y,this.point.x-this.extra.x,this.point.y-this.extra.y]).P():"M 0 0",h=!this.matte&&this.slope&&"M 0 0"!==e?(new q.trans2d).rotate(-this.slope*Math.PI/180,this.point.x,this.point.y):
!1;b.vml2d&&!(b.vml2d.style.display=this.matte?"none":"")?(b.vml2d.path=e,b.vml2d.stuff.color=(b.vml2d.stuff.on=!!this.stuff)?this.stuff:"",b.vml2d.write.color=this.color,b.vml2d.write.weight=this.thick,b.vml2d.write.dashstyle=this.style,b.vml2d.stuff.opacity=b.vml2d.write.opacity=this.alpha/100,(b.vml2d.slope.on=!!h)?(b.vml2d.slope.offset=h.offset(!0),b.vml2d.slope.matrix=h.matrix(!0)):(b.vml2d.slope.removeAttribute("offset"),b.vml2d.slope.removeAttribute("matrix"))):b.run2d=!d.Fx.draw.call(c,f,
[d.Util.format(g.rect,[e,b.ident,this.color,this.thick,this.alpha/100,this.style,!!this.stuff,this.stuff||"",this.matte?"none":""])],function(){(b.vml2d=d.Array.pop(d.Fn.css.call(f,"."+b.ident)))&&(b.vml2d.write=d.Dom.getPrev(b.vml2d.stuff=d.Dom.getLast(b.vml2d)))&&d.Fx.draw.call(c,b.vml2d,[g.skew],function(){(b.run2d=!1,b.vml2d.slope=d.Dom.getLast(b.vml2d))&&(b.vml2d.slope.on=!!h)&&(b.vml2d.slope.offset=h.offset(!0),b.vml2d.slope.matrix=h.matrix(!0))})})}}}),POLY:l(function(b,e){this.route=e.route;
this.thick=e.thick;this.color=e.color;this.stuff=e.stuff;this.style=e.style;this.paint=function(){if((b||0).alive)if(b.run2d||!f||!b.ident)d.Thread.delay.call(c,arguments.callee,0,this);else if(u.call(this)){var e=3<(this.route||0).length?(new k).M(d.Array.slice(this.route,0,2)).L(d.Array.slice(this.route,2)).Z().P():"M 0 0";b.vml2d&&!(b.vml2d.style.display=this.matte?"none":"")?(b.vml2d.path=e,b.vml2d.stuff.color=(b.vml2d.stuff.on=!!this.stuff)?this.stuff:"",b.vml2d.write.color=this.color,b.vml2d.write.weight=
this.thick,b.vml2d.write.dashstyle=this.style,b.vml2d.stuff.opacity=b.vml2d.write.opacity=this.alpha/100):b.run2d=!d.Fx.draw.call(c,f,[d.Util.format(g.poly,[e,b.ident,this.color,this.thick,this.alpha/100,this.style,!!this.stuff,this.stuff||"",this.matte?"none":""])],function(){if(b.run2d=!1,b.vml2d=d.Array.pop(d.Fn.css.call(f,"."+b.ident)))b.vml2d.write=d.Dom.getPrev(b.vml2d.stuff=d.Dom.getLast(b.vml2d))})}}}),OVAL:l(function(b,e){this.point=e.point;this.extra=e.extra;this.thick=e.thick;this.color=
e.color;this.stuff=e.stuff;this.slope=e.slope;this.style=e.style;this.paint=function(){if((b||0).alive)if(b.run2d||!f||!b.ident)d.Thread.delay.call(c,arguments.callee,0,this);else if(u.call(this)){var e=this.point&&this.extra?(new k).A([this.point.x,this.point.y,this.extra.x,this.extra.y,0,23592960]).Z().P():"M 0 0",h=!this.matte&&this.slope&&"M 0 0"!==e?(new q.trans2d).rotate(-this.slope*Math.PI/180,this.point.x,this.point.y):!1;b.vml2d&&!(b.vml2d.style.display=this.matte?"none":"")?(b.vml2d.path=
e,b.vml2d.stuff.color=(b.vml2d.stuff.on=!!this.stuff)?this.stuff:"",b.vml2d.write.color=this.color,b.vml2d.write.weight=this.thick,b.vml2d.write.dashstyle=this.style,b.vml2d.stuff.opacity=b.vml2d.write.opacity=this.alpha/100,(b.vml2d.slope.on=!!h)?(b.vml2d.slope.offset=h.offset(!0),b.vml2d.slope.matrix=h.matrix(!0)):(b.vml2d.slope.removeAttribute("offset"),b.vml2d.slope.removeAttribute("matrix"))):b.run2d=!d.Fx.draw.call(c,f,[d.Util.format(g.oval,[e,b.ident,this.color,this.thick,this.alpha/100,this.style,
!!this.stuff,this.stuff||"",this.matte?"none":""])],function(){(b.vml2d=d.Array.pop(d.Fn.css.call(f,"."+b.ident)))&&(b.vml2d.write=d.Dom.getPrev(b.vml2d.stuff=d.Dom.getLast(b.vml2d)))&&d.Fx.draw.call(c,b.vml2d,[g.skew],function(){(b.run2d=!1,b.vml2d.slope=d.Dom.getLast(b.vml2d))&&(b.vml2d.slope.on=!!h)&&(b.vml2d.slope.offset=h.offset(!0),b.vml2d.slope.matrix=h.matrix(!0))})})}}}),ARCH:l(function(b,e){this.angle=e.angle;this.point=e.point;this.extra=e.extra;this.thick=e.thick;this.color=e.color;this.stuff=
e.stuff;this.slope=e.slope;this.style=e.style;this.paint=function(){if((b||0).alive)if(b.run2d||!f||!b.ident)d.Thread.delay.call(c,arguments.callee,0,this);else if(u.call(this)){var e=this.point&&this.extra&&this.angle?(new k).A([this.point.x,this.point.y,this.extra.x,this.extra.y,11796480*q.ang2ecc(this.angle.f,this.extra.x,this.extra.y)/Math.PI,11796480*(q.ang2ecc(this.angle.t,this.extra.x,this.extra.y)-q.ang2ecc(this.angle.f,this.extra.x,this.extra.y))/Math.PI]).L([this.point.x,this.point.y]).Z().P():
"M 0 0",h=!this.matte&&this.slope&&"M 0 0"!==e?(new q.trans2d).rotate(-this.slope*Math.PI/180,this.point.x,this.point.y):!1;b.vml2d&&!(b.vml2d.style.display=this.matte?"none":"")?(b.vml2d.path=e,b.vml2d.stuff.color=(b.vml2d.stuff.on=!!this.stuff)?this.stuff:"",b.vml2d.write.color=this.color,b.vml2d.write.weight=this.thick,b.vml2d.write.dashstyle=this.style,b.vml2d.stuff.opacity=b.vml2d.write.opacity=this.alpha/100,(b.vml2d.slope.on=!!h)?(b.vml2d.slope.offset=h.offset(!0),b.vml2d.slope.matrix=h.matrix(!0)):
(b.vml2d.slope.removeAttribute("offset"),b.vml2d.slope.removeAttribute("matrix"))):b.run2d=!d.Fx.draw.call(c,f,[d.Util.format(g.arch,[e,b.ident,this.color,this.thick,this.alpha/100,this.style,!!this.stuff,this.stuff||"",this.matte?"none":""])],function(){(b.vml2d=d.Array.pop(d.Fn.css.call(f,"."+b.ident)))&&(b.vml2d.write=d.Dom.getPrev(b.vml2d.stuff=d.Dom.getLast(b.vml2d)))&&d.Fx.draw.call(c,b.vml2d,[g.skew],function(){(b.run2d=!1,b.vml2d.slope=d.Dom.getLast(b.vml2d))&&(b.vml2d.slope.on=!!h)&&(b.vml2d.slope.offset=
h.offset(!0),b.vml2d.slope.matrix=h.matrix(!0))})})}}}),WAVE:l(function(b,e){this.route=e.route;this.thick=e.thick;this.color=e.color;this.arrow=e.arrow;this.style=e.style;this.paint=function(){if((b||0).alive)if(b.run2d||!f||!b.ident)d.Thread.delay.call(c,arguments.callee,0,this);else if(u.call(this)){var e=5<(this.route||0).length?(new k).M(d.Array.slice(this.route,0,2))[8===this.route.length?"C":"Q"](d.Array.slice(this.route,2)).P():"M 0 0";b.vml2d&&!(b.vml2d.style.display=this.matte?"none":"")?
(b.vml2d.path=e,b.vml2d.write.color=this.color,b.vml2d.write.weight=this.thick,b.vml2d.write.dashstyle=this.style,b.vml2d.write.opacity=this.alpha/100,b.vml2d.write.endarrow=this.arrow?"classic":"none"):b.run2d=!d.Fx.draw.call(c,f,[d.Util.format(g.wave,[e,b.ident,this.color,this.thick,this.alpha/100,this.style,this.arrow?"classic":"none",this.matte?"none":""])],function(){if(b.run2d=!1,b.vml2d=d.Array.pop(d.Fn.css.call(f,"."+b.ident)))b.vml2d.write=d.Dom.getFore(b.vml2d)})}}})}}}(function(){this.save=
[]},{line:'<v:shape coordsize="1,1" style="width:1px;height:1px;display:$8;" path="$1" class="$2"><v:stroke color="$3" weight="$4" opacity="$5" dashstyle="$6" endarrow="$7"></v:stroke><v:fill on="f"></v:fill></v:shape>',rect:'<v:shape coordsize="1,1" style="width:1px;height:1px;display:$9;" path="$1" class="$2"><v:stroke color="$3" weight="$4" opacity="$5" dashstyle="$6" endarrow="none"></v:stroke><v:fill on="$7" color="$8" opacity="$5"></v:fill></v:shape>',poly:'<v:shape coordsize="1,1" style="width:1px;height:1px;display:$9;" path="$1" class="$2"><v:stroke color="$3" weight="$4" opacity="$5" dashstyle="$6" endarrow="none"></v:stroke><v:fill on="$7" color="$8" opacity="$5"></v:fill></v:shape>',
oval:'<v:shape coordsize="1,1" style="width:1px;height:1px;display:$9;" path="$1" class="$2"><v:stroke color="$3" weight="$4" opacity="$5" dashstyle="$6" endarrow="none"></v:stroke><v:fill on="$7" color="$8" opacity="$5"></v:fill></v:shape>',arch:'<v:shape coordsize="1,1" style="width:1px;height:1px;display:$9;" path="$1" class="$2"><v:stroke color="$3" weight="$4" opacity="$5" dashstyle="$6" endarrow="none"></v:stroke><v:fill on="$7" color="$8" opacity="$5"></v:fill></v:shape>',wave:'<v:shape coordsize="1,1" style="width:1px;height:1px;display:$8;" path="$1" class="$2"><v:stroke color="$3" weight="$4" opacity="$5" dashstyle="$6" endarrow="$7"></v:stroke><v:fill on="f"></v:fill></v:shape>',
skew:'<v:skew on="f"></v:skew>'}):null;d.Graphic=function(k,g){if(D&&k){var c=new D(d.Util.getWin(g),d.Util.getDoc(g),d.Match.isString(k)?d.Fn.id(k):k,!1);if((c||0).ready())this.renewStage=function(){c.renew()},this.clearStage=function(){c.clear()},this.refixStage=function(d){c.refix(d)},this.sliceStage=function(d){c.slice(d)},this.createLine=function(d){return new c.build.LINE({alive:!0},d)},this.createRect=function(d){return new c.build.RECT({alive:!0},d)},this.createPoly=function(d){return new c.build.POLY({alive:!0},
d)},this.createOval=function(d){return new c.build.OVAL({alive:!0},d)},this.createArch=function(d){return new c.build.ARCH({alive:!0},d)},this.createWave=function(d){return new c.build.WAVE({alive:!0},d)};else throw"Prepare Exception";}else throw"Support Exception";}})(jMagic);
